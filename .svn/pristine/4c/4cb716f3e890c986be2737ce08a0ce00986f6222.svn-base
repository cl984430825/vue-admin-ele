<template>
  <div id="engineerCompile">
    <div class="engineerCompile_container">
      <el-tabs v-model="activeIndex" @tab-click="handleClick">
        <el-tab-pane label="基础信息" name="1">
          <div class="form_box">
            <el-form :model="ruleForm" :rules="rules" ref="ruleForm" label-width="100px" class="demo-ruleForm">
              <el-form-item label="工程名称：" prop="gcName">
                <el-input 
                clearable
                maxlength="20"
                style="width:260px" 
                v-model="ruleForm.gcName" 
                placeholder="请输入工程名称"></el-input>
              </el-form-item>
              <el-form-item label="场站：" prop="park">
                <el-input 
                clearable
                maxlength="20"
                style="width:260px" 
                v-model="ruleForm.park" 
                placeholder="请输入场站"></el-input>
              </el-form-item>
              <el-form-item label="工程状态：" prop="status">
                <el-radio v-model="ruleForm.status" :label="1">进行中</el-radio>
                <el-radio v-model="ruleForm.status" :label="2">已完成</el-radio>
              </el-form-item>
              <el-form-item label="结算金额：" prop="money">
                <el-input 
                clearable
                style="width:260px" 
                v-model="ruleForm.money"
                placeholder="请输入金额">
                  <template slot="prepend">￥</template>
                </el-input>
              </el-form-item>
              <el-form-item>
                <el-button size="medium" type="primary">
                  <i class="el-icon-document-add"></i>
                  <span>保存</span>
                </el-button>
                <el-button @click="toBack" size="medium">返回列表</el-button>
              </el-form-item>
            </el-form>
          </div>
          <div class="one_moneyBox">
            <div class="ul_box">
              <div class="li_box">
                <span class="labelCls">合同金额</span>
                <span class="labelCls moneyNum">296,000</span>
              </div>
            </div>
            <div class="ul_box">
              <div class="li_box">
                <span class="labelCls">已支付</span>
                <span class="labelCls moneyNum">296,000</span>
              </div>
              <div class="li_box thredLeft">
                <span class="labelCls">未支付</span>
                <span class="labelCls moneyNum">390,000</span>
              </div>
            </div>
            <div class="ul_box" style="border:0">
              <div class="li_box">
                <span class="labelCls">发票未税</span>
                <span class="labelCls moneyNum">296,000</span>
              </div>
              <div class="li_box thredLeft">
                <span class="labelCls">发票含税</span>
                <span class="labelCls moneyNum">390,000</span>
              </div>
              <div class="li_box thredLeft">
                <span class="labelCls">暂估未税</span>
                <span class="labelCls moneyNum">390,000</span>
              </div>
              <div class="li_box thredLeft">
                <span class="labelCls">暂估含税</span>
                <span class="labelCls moneyNum">390,000</span>
              </div>
            </div>
          </div>
        </el-tab-pane>
        <el-tab-pane label="项目信息" name="2">
          <div class="table_box">
            <div class="flexBetween">
              <el-input 
              clearable
              v-model="projectSearch"
              style="width:300px" 
              placeholder="批次/编号/发票号">
                <el-button slot="append" icon="el-icon-search"></el-button>
              </el-input>
              <el-button @click="dialogVisible=true" size="medium">+ 添加项目</el-button>
            </div>
            <el-table 
            border
            class="_top"
            :data="projectTable"
            :header-cell-style="{background:'#F6F5F4'}">
              <el-table-column label="合同号" width="200">123</el-table-column>
              <el-table-column label="项目内容" width="200">123</el-table-column>
              <el-table-column label="合同金额" width="100">123</el-table-column>
              <el-table-column label="签订日期" width="100">123</el-table-column>
              <el-table-column label="合同对方" width="150">123</el-table-column>
              <el-table-column label="发票含税" width="100">123</el-table-column>
              <el-table-column label="发票未税" width="100">123</el-table-column>
              <el-table-column label="暂估含税" width="100">123</el-table-column>
              <el-table-column label="暂估未税" width="100">123</el-table-column>
              <el-table-column label="已支付" width="100">123</el-table-column>
              <el-table-column label="未支付" width="100">123</el-table-column>
              <el-table-column label="支付方式" width="300">123</el-table-column>
              <el-table-column label="操作" fixed="right" width="255">
                <template slot-scope="scope">
                  <span @click="compileProject(scope)" class="blueText">编辑</span>
                  <span @click="toInvoice(scope)" class="blueText _left">发票管理</span>
                  <span class="blueText _left">付款记录</span>
                  <span class="blueText _left">删除</span>
                </template>
              </el-table-column>
            </el-table>
            <Page :pageConfig="pageConfig" />
          </div>
        </el-tab-pane>
        <el-tab-pane label="物资信息" name="3">
          <div class="table_box">
            <el-input 
              clearable
              v-model="engineerSearch"
              style="width:300px" 
              placeholder="批次/编号/发票号">
              <el-button slot="append" icon="el-icon-search"></el-button>
            </el-input>
            <el-table border class="_top" :data="engTable" :header-cell-style="{background:'#F6F5F4'}">
              <el-table-column label="供应商">1</el-table-column>
              <el-table-column label="物资名称">2</el-table-column>
              <el-table-column label="物资编号">3</el-table-column>
              <el-table-column label="领用人">4</el-table-column>
              <el-table-column label="使用状况">5</el-table-column>
              <el-table-column label="发票编号">1</el-table-column>
              <el-table-column label="入库时间">2</el-table-column>
              <el-table-column label="领用时间">123</el-table-column>
              <el-table-column label="转入数量">123</el-table-column>
              <el-table-column label="转入未税（元）" width="120">123</el-table-column>
            </el-table>
            <Page :pageConfig="endPageConfig" />
          </div>
        </el-tab-pane>
      </el-tabs>
    </div>
    <el-dialog
      width="50%"
      title="添加项目"
      :visible.sync="dialogVisible">
      <el-form :model="projectForm" :rules="projectFormRules" ref="ruleForm" label-width="100px" class="demo-ruleForm">
        <div class="flexBox">
          <el-form-item label="合同号：" prop="hth" class="flexFormItem">
            <el-input v-model="projectForm.hth"></el-input>
          </el-form-item>
          <el-form-item label="项目内容：" prop="xmnr" class="flexFormItem">
            <el-input v-model="projectForm.xmnr"></el-input>
          </el-form-item>
        </div>
        <div class="flexBox">
          <el-form-item label="签订日期：" prop="qdrq" class="flexFormItem">
            <el-date-picker
              v-model="projectForm.qdrq"
              type="date"
              placeholder="签订日期">
            </el-date-picker>
          </el-form-item>
          <el-form-item label="合同对方：" prop="htdf" class="flexFormItem">
            <el-input v-model="projectForm.htdf"></el-input>
          </el-form-item>
        </div>
        <div class="flexBox">
          <el-form-item label="合同金额：" prop="htje" class="flexFormItem">
            <el-input v-model="projectForm.htje"></el-input>
          </el-form-item>
          <el-form-item label="默认税率：" prop="mrsl" class="flexFormItem">
            <el-input-number v-model="projectForm.mrsl" controls-position="right" :min="1"></el-input-number> %
          </el-form-item>
        </div>
        <div class="flexBox">
          <el-form-item label="已支付：" prop="yzf" class="flexFormItem">
            <div class="flexBox">
              <el-input v-model="projectForm.yzf" disabled>
                <template slot="prepend">￥</template>
              </el-input>
              <span class="blueText _left">付款记录</span>
            </div>
          </el-form-item>
          <el-form-item label="未支付：" prop="wzf" class="flexFormItem">
            <el-input v-model="projectForm.wzf" disabled>
              <template slot="prepend">￥</template>
            </el-input>
          </el-form-item>
        </div>
        <el-form-item label="付款方式：" prop="fkfs" class="flexFormItem">
          <el-input v-model="projectForm.fkfs"></el-input>
        </el-form-item>
        <el-divider content-position="center">
          <span class="labelCls">根据发票信息自动统计填写</span>
        </el-divider>
        <div class="flexBox">
          <el-form-item label="发票未税：" prop="fpws" class="flexFormItem">
            <el-input v-model="projectForm.fpws" disabled>
              <template slot="prepend">￥</template>
            </el-input>
          </el-form-item>
          <el-form-item label="发票含税：" prop="fphs" class="flexFormItem">
            <el-input v-model="projectForm.fphs" disabled>
              <template slot="prepend">￥</template>
            </el-input>
          </el-form-item>
        </div>
        <div class="flexBox">
          <el-form-item label="暂估未税：" prop="zgws" class="flexFormItem">
            <el-input v-model="projectForm.zgws" disabled>
              <template slot="prepend">￥</template>
            </el-input>
          </el-form-item>
          <el-form-item label="暂估含税：" prop="zghs" class="flexFormItem">
            <el-input v-model="projectForm.zghs" disabled>
              <template slot="prepend">￥</template>
            </el-input>
          </el-form-item>
        </div>
        <el-form-item>
          <el-button type="primary" size="medium">确 定</el-button>
          <el-button size="medium">取 消</el-button>
        </el-form-item>
      </el-form>
    </el-dialog>
  </div>
</template>

<script>
export default {
  name: "engineerCompile",
  components: {
    "Page": resolve => require(["@/components/page.vue"], resolve)
  },
  data () {
    return {
      // tab选中项
      activeIndex: "1",
      // 基础信息表单
      ruleForm: {
        gcName: "",
        park: "",
        status: 1,
        money: ""
      },
      // 表单校验规则
      rules: {
        gcName: { required: true, message: '请输入工程名称', trigger: 'blur' },
        status: { required: true },
      },
      // 项目信息索引项
      projectSearch: "",
      // 物资信息索引项
      engineerSearch: "",
      // 项目信息table
      projectTable: [1,2,3],
      // 物资信息table
      engTable: [1,2,3],
      // 项目信息分页配置项
      pageConfig: {
        pageNum: 1,
        pageSize: 10,
        total: 0
      },
      // 物资信息分页配置项
      endPageConfig: {
        pageNum: 1,
        pageSize: 10,
        total: 0
      },
      // 添加项目dialog
      dialogVisible: false,
      // 添加项目表单
      projectForm: {
        hth: "",
        xmnr: "",
        qdrq: "",
        htdf: "",
        htje: "",
        mrsl: "",
        yzf: "",
        wzf: "",
        fkfs: "",
        fpws: "",
        fphs: "",
        zgws: "",
        zghs: ""
      },
      // 项目表单校验规则
      projectFormRules: {
        hth: { required: true, message: '请输入合同号', trigger: 'blur' },
        xmnr: { required: true, message: '请输入项目内容', trigger: 'blur' },
        qdrq: { required: true, message: '请选择签订日期', trigger: 'blur' },
        htdf: { required: true, message: '请输入合同对方', trigger: 'blur' },
        htje: { required: true, message: '请输入合同金额', trigger: 'blur' },
      }
    }
  },
  methods: {
    // 编辑项目信息
    compileProject(scope){
      this.dialogVisible = true;
    },
    // 发票管理
    toInvoice(scope){
      this.$router.push("/engineering/invoiceMng");
    }
  }
}
</script>

<style scoped>
.engineerCompile_container{
  background: #ffffff;
}
.form_box{
  padding: 20px 20px 0 20px;
}
.one_moneyBox{
  display: flex;
  align-items: center;
  border-top: 1px solid #dddddd;
}
.ul_box{
  display: flex;
  align-items: center;
  padding: 20px 30px;
  border-right: 1px solid #dddddd;
}
.li_box{
  display: flex;
  flex-direction: column;
}
.moneyNum{
  font-size: 20px;
  margin-top: 20px;
}
.thredLeft{
  margin-left: 30px;
}
.table_box{
  padding: 10px 20px 20px 20px;
}
.flexFormItem{
  width: 100%;
}
</style>
